<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      Feedback and Complaint Management - Passport Application Admin
    </title>
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
      rel="stylesheet"
    />
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <style>
      .logo {
        width: 100px;
        height: 100px;
      }
      .header-message {
        font-size: 1.2rem;
        font-weight: bold;
        color: #0056b3;
      }
    </style>
  </head>
  <body class="d-flex flex-column min-vh-100">
    <!-- Header Section -->
    <div class="container-fluid mt-3">
      <div class="d-flex align-items-start">
        <img src="passportlogo.jpeg" alt="Logo" class="logo mr-3" />
        <div class="header-message">
          Passport Seva<br />
          PSP Division<br />
          Ministry of External Affairs, Government of India
        </div>
      </div>
    </div>

    <!--Navigation bar-->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary mt-3">
      <a class="navbar-brand" href="index.html">Passport Seva Admin</a>
      <button
        class="navbar-toggler"
        type="button"
        data-toggle="collapse"
        data-target="#navbarNav"
        aria-controls="navbarNav"
        aria-expanded="false"
        aria-label="Toggle navigation"
      >
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav mr-auto">
          <li class="nav-item">
            <a class="nav-link" href="index.html">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="user_management.html">User Management</a>
          </li>
          <li class="nav-item">
            <a class="nav-link active" href="feedback_management.html"
              >Feedback Management</a
            >
          </li>
        </ul>
        <form class="form-inline my-2 my-lg-0">
          <input
            class="form-control mr-sm-2"
            type="search"
            placeholder="Search"
            aria-label="Search"
          />
          <button class="btn btn-outline-light my-2 my-sm-0" type="submit">
            <i class="fa fa-search"></i>
          </button>
        </form>
      </div>
    </nav>

    <div class="container mt-4">
      <h1 class="text-center text-primary mb-4">
        Feedback and Complaint Management
      </h1>

      <!-- Feedback/Complaint List -->
      <div class="card mb-4">
        <div class="card-body">
          <h2 class="card-title">List of Feedback and Complaints</h2>
          <div class="table-responsive">
            <table class="table table-bordered">
              <thead class="thead-dark">
                <tr>
                  <th>Username</th>
                  <th>Type</th>
                  <th>Description</th>
                  <th>Solution</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody id="feedback-list">
                <!-- Feedback/complaint list rows will be dynamically added here -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer Section -->
    <footer class="bg-primary text-white text-center mt-auto">
      <div class="container">
        <p>
          Connect with us on:
          <a href="https://www.facebook.com" class="text-white">Facebook</a> |
          <a href="https://www.Twitter.com" class="text-white">Twitter</a> |
          <a href="https://www.Instagram.com" class="text-white">Instagram</a>
        </p>
        <p>
          Contact Us: <a href="contact.html" class="text-white">Contact Us</a>
        </p>
        <p>Customer Care Helpline: 1800-123-456</p>
      </div>
    </footer>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Retrieve username from URL (simulated as 'admin' query parameter)
        const urlParams = new URLSearchParams(window.location.search);
        const adminUsername = urlParams.get("admin");

        // Function to retrieve feedback/complaints from localStorage
        function getFeedbackFromLocalStorage() {
          return JSON.parse(localStorage.getItem("passportFeedback")) || {};
        }

        // Function to update feedback/complaints in localStorage
        function updateFeedbackInLocalStorage(feedback) {
          localStorage.setItem("passportFeedback", JSON.stringify(feedback));
        }

        // Function to display feedback/complaints in the table
        function displayFeedback(feedback) {
          const feedbackListTable = document.getElementById("feedback-list");

          // Clear existing rows
          feedbackListTable.innerHTML = "";

          // Iterate through feedback/complaints and display them in the table
          for (const username in feedback) {
            if (feedback.hasOwnProperty(username)) {
              const userFeedback = feedback[username];
              userFeedback.forEach((item) => {
                const row = document.createElement("tr");
                row.innerHTML = `
                <td>${username}</td>
                <td>${item.type}</td>
                <td>${item.description}</td>
                <td>
                  <textarea class="form-control" rows="3" id="solution-${username}" data-feedback-index="${userFeedback.indexOf(
                  item
                )}">${item.solution || ""}</textarea>
                </td>
                <td>
                  <button class="btn btn-sm btn-primary update-solution" data-username="${username}" data-feedback-index="${userFeedback.indexOf(
                  item
                )}">Update Solution</button>
                </td>
              `;
                feedbackListTable.appendChild(row);
              });
            }
          }

          // Add event listeners to update solution buttons
          document.querySelectorAll(".update-solution").forEach((button) => {
            button.addEventListener("click", function () {
              const username = this.getAttribute("data-username");
              const feedbackIndex = this.getAttribute("data-feedback-index");
              updateSolution(username, feedbackIndex);
            });
          });
        }

        // Function to update solution for feedback/complaint
        function updateSolution(username, feedbackIndex) {
          const feedback = getFeedbackFromLocalStorage();
          const userFeedback = feedback[username];

          if (!userFeedback || feedbackIndex >= userFeedback.length) {
            alert("Feedback not found.");
            return;
          }

          // Update solution for selected feedback/complaint
          const solutionTextarea = document.getElementById(
            `solution-${username}`
          );
          const updatedSolution = solutionTextarea.value.trim();

          // Update in localStorage
          userFeedback[feedbackIndex].solution = updatedSolution;
          feedback[username] = userFeedback;
          updateFeedbackInLocalStorage(feedback);

          // Provide feedback to admin or confirmation message
          alert(`Solution updated for ${username}'s feedback/complaint.`);
        }

        // Initialize feedback/complaint list display
        const feedback = getFeedbackFromLocalStorage();
        displayFeedback(feedback);
      });
    </script>
  </body>
</html>
