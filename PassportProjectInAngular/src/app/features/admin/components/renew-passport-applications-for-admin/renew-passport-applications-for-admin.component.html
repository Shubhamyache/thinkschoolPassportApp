<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>User Management - ReNew Passport Application Admin</title>
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
      rel="stylesheet"
    />
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <style>
      .logo {
        width: 100px;
        height: 100px;
      }
      .header-message {
        font-size: 1.2rem;
        font-weight: bold;
        color: #0056b3;
      }
    </style>
  </head>
  <body class="d-flex flex-column min-vh-100">
    <!-- Header Section -->
    <div class="container-fluid mt-3">
      <div class="d-flex align-items-start">
        <img src="passportlogo.jpeg" alt="Logo" class="logo mr-3" />
        <div class="header-message">
          Passport Seva<br />
          PSP Division<br />
          Ministry of External Affairs, Government of India
        </div>
      </div>
    </div>

    <!--Navigation bar-->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary mt-3">
      <a class="navbar-brand" href="index.html">Passport Seva Admin</a>
      <button
        class="navbar-toggler"
        type="button"
        data-toggle="collapse"
        data-target="#navbarNav"
        aria-controls="navbarNav"
        aria-expanded="false"
        aria-label="Toggle navigation"
      >
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav mr-auto">
          <li class="nav-item">
            <a class="nav-link" href="index.html">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link active" href="user_management.html"
              >User Management</a
            >
          </li>
          <li class="nav-item">
            <a class="nav-link" href="feedback_management.html"
              >Feedback Management</a
            >
          </li>
        </ul>
        <form class="form-inline my-2 my-lg-0">
          <input
            class="form-control mr-sm-2"
            type="search"
            placeholder="Search"
            aria-label="Search"
          />
          <button class="btn btn-outline-light my-2 my-sm-0" type="submit">
            <i class="fa fa-search"></i>
          </button>
        </form>
      </div>
    </nav>

    <div class="container mt-4">
      <h1 class="text-center text-primary mb-4">User Management</h1>

      <!-- User List Table -->
      <div class="card mb-4">
        <div class="card-body">
          <h2 class="card-title">List of Users</h2>
          <div class="table-responsive">
            <table class="table table-bordered">
              <thead class="thead-dark">
                <tr>
                  <th>Username</th>
                  <th>Email</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody id="user-list">
                <!-- User list rows will be dynamically added here -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer Section -->
    <footer class="bg-primary text-white text-center mt-auto">
      <div class="container">
        <p>
          Connect with us on:
          <a href="https://www.facebook.com" class="text-white">Facebook</a> |
          <a href="https://www.Twitter.com" class="text-white">Twitter</a> |
          <a href="https://www.Instagram.com" class="text-white">Instagram</a>
        </p>
        <p>
          Contact Us: <a href="contact.html" class="text-white">Contact Us</a>
        </p>
        <p>Customer Care Helpline: 1800-123-456</p>
      </div>
    </footer>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Retrieve username from URL (simulated as 'admin' query parameter)
        const urlParams = new URLSearchParams(window.location.search);
        const adminUsername = urlParams.get("admin");

        // Function to retrieve users from localStorage
        function getUsersFromLocalStorage() {
          return JSON.parse(localStorage.getItem("passportUsers")) || {};
        }

        // Function to update users in localStorage
        function updateUsersInLocalStorage(users) {
          localStorage.setItem("passportUsers", JSON.stringify(users));
        }

        // Function to display users in the table
        function displayUsers(users) {
          const userListTable = document.getElementById("user-list");

          // Clear existing rows
          userListTable.innerHTML = "";

          // Iterate through users and display them in the table
          for (const username in users) {
            if (users.hasOwnProperty(username)) {
              const user = users[username];
              const row = document.createElement("tr");
              row.innerHTML = `
              <td>${username}</td>
              <td>${user.email}</td>
              <td>
                <button class="btn btn-sm btn-primary mr-2 edit-user" data-username="${username}">Edit</button>
                <button class="btn btn-sm btn-danger delete-user" data-username="${username}">Delete</button>
                <button class="btn btn-sm btn-info send-feedback" data-username="${username}">Send Feedback</button>
              </td>
            `;
              userListTable.appendChild(row);
            }
          }

          // Add event listeners to buttons
          document.querySelectorAll(".edit-user").forEach((button) => {
            button.addEventListener("click", function () {
              const username = this.getAttribute("data-username");
              editUser(username);
            });
          });

          document.querySelectorAll(".delete-user").forEach((button) => {
            button.addEventListener("click", function () {
              const username = this.getAttribute("data-username");
              deleteUser(username);
            });
          });

          document.querySelectorAll(".send-feedback").forEach((button) => {
            button.addEventListener("click", function () {
              const username = this.getAttribute("data-username");
              sendFeedback(username);
            });
          });
        }

        // Function to edit user details
        function editUser(username) {
          const users = getUsersFromLocalStorage();
          const user = users[username];

          if (!user) {
            alert("User not found.");
            return;
          }

          // Example: Update user details logic
          // Here I can modify user details and update in localStorage
          // Have to Replace this with logic as per application's requirements
          const updatedUser = {
            ...user,
            email:
              prompt("Enter new email for " + username, user.email) ||
              user.email,
            // Here more fields as required
          };

          // Update user in localStorage
          users[username] = updatedUser;
          updateUsersInLocalStorage(users);

          // Refresh user list display
          displayUsers(users);
        }

        // Function to delete user
        function deleteUser(username) {
          const users = getUsersFromLocalStorage();

          if (confirm(`Are you sure you want to delete user '${username}'?`)) {
            delete users[username];
            updateUsersInLocalStorage(users);

            // Refresh user list display
            displayUsers(users);
          }
        }

        // Function to send feedback to user
        function sendFeedback(username) {
          const feedbackMessage = prompt("Enter feedback for " + username);

          // Example: Send feedback logic
          // Replace this with logic to send feedback to the user
          if (feedbackMessage) {
            alert(`Feedback sent to '${username}': ${feedbackMessage}`);
          }
        }

        // Initialize user list display
        const users = getUsersFromLocalStorage();
        displayUsers(users);
      });
    </script>
  </body>
</html>
